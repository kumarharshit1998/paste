using Microsoft.AspNetCore.Mvc.Rendering;
using Microsoft.Data.SqlClient;
using Microsoft.EntityFrameworkCore;
using System.Data;

public class ExcelRepository : IExcelRepository
{
    private readonly ApplicationDbContext _db;

    public ExcelRepository(ApplicationDbContext db)
    {
        _db = db;
    }

    public List<SelectListItem> GetDropdownColumns(string sheetName)
    {
        var columns = new List<SelectListItem>();

        using (var command = _db.Database.GetDbConnection().CreateCommand())
        {
            command.CommandText = "GetExcelColumns"; // Your SP name
            command.CommandType = CommandType.StoredProcedure;

            var param = command.CreateParameter();
            param.ParameterName = "@SheetName";
            param.Value = sheetName;
            command.Parameters.Add(param);

            _db.Database.OpenConnection();

            using (var reader = command.ExecuteReader())
            {
                while (reader.Read())
                {
                    columns.Add(new SelectListItem
                    {
                        Value = reader.GetString(0),
                        Text = reader.GetString(1)
                    });
                }
            }
        }

        return columns;
    }
}
