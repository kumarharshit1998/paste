[HttpGet]
public IActionResult Upload()
{
    return View();
}

[HttpPost]
public IActionResult Upload(IFormFile ExcelFile)
{
    if (ExcelFile == null || ExcelFile.Length == 0)
    {
        ViewBag.Error = "Please select a file.";
        return View();
    }

    using var stream = new MemoryStream();
    ExcelFile.CopyTo(stream);
    using var package = new ExcelPackage(stream);
    var sheetNames = package.Workbook.Worksheets.Select(ws => ws.Name).ToList();

    // Store the uploaded file in TempData as base64 for the next step
    TempData["ExcelFileBase64"] = Convert.ToBase64String(stream.ToArray());
    ViewBag.SheetNames = sheetNames;
    ViewBag.ShowSheetSelector = true;

    return View();
}
