try
    {
        if (ExcelFile == null || ExcelFile.Length == 0)
            return Content("No file uploaded.");

        ExcelPackage.LicenseContext = LicenseContext.NonCommercial;

        using var stream = new MemoryStream();
        ExcelFile.CopyTo(stream);
        stream.Position = 0;

        // Don't store huge Base64 in TempData
        // TempData["ExcelFileBase64"] = Convert.ToBase64String(stream.ToArray());

        using var package = new ExcelPackage(stream);

        var sheetNames = new List<string>();
        foreach (var sheet in package.Workbook.Worksheets)
        {
            sheetNames.Add(sheet.Name);
        }

        ViewBag.SheetNames = sheetNames;
        ViewBag.Stage = "SelectSheet";

        return View("SelectSheet"); // or return View(); if staying on the same view
    }
    catch (Exception ex)
    {
        return Content("Error: " + ex.Message);
    }
